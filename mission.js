// ====== Auth guard ======
const auth = firebase.auth();
const db   = firebase.firestore();

const LEVEL_COUNT = 15; // 15 checkpoints
let CURRENT_POINTS = 0;
let CURRENT_USER = null; // for writing stats

// tiny safe logger
const log = (...a) => { try { console.log(...a); } catch(_){} };

// ====== Start ======
auth.onAuthStateChanged(async (user) => {
  if (!user) return location.href = "login.html";
  CURRENT_USER = user;
  setupSidebar();
  try { await buildPath(user); }
  catch (e) { log("buildPath error:", e); toast("‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡πÅ‡∏•‡πâ‡∏ß‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà"); }
});

// ====== Sidebar ======
function setupSidebar() {
  const toggleBtn = document.getElementById("menu-toggle");
  const sidebar   = document.getElementById("sidebar");
  const overlay   = document.getElementById("overlay");
  const closeBtn  = document.getElementById("close-sidebar");
  const logout    = document.getElementById("logout-link");

  const open  = () => { sidebar.classList.add("open");  overlay.classList.add("active"); };
  const close = () => { sidebar.classList.remove("open"); overlay.classList.remove("active"); };

  toggleBtn?.addEventListener("click", open);
  closeBtn?.addEventListener("click", close);
  overlay?.addEventListener("click", close);
  document.querySelectorAll("#sidebar .menu-item a").forEach(a=>{
    if (!a.closest("#logout-link")) a.addEventListener("click", close);
  });
  logout?.addEventListener("click", (e)=>{ e.preventDefault(); auth.signOut().then(()=>location.href="login.html"); });
}

// ====== QUESTION BANKS (TH) ======
const Q1_BASIC = [
  { q:"‡πÇ‡∏£‡∏Ñ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏™‡∏°‡∏≠‡∏á‡∏°‡∏µ‡∏ä‡∏ô‡∏¥‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏µ‡πà‡∏ä‡∏ô‡∏¥‡∏î?",
    opts:["‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏ô‡∏¥‡∏î:‡πÅ‡∏ï‡∏Å,‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏ï‡∏∑‡πà‡∏ô","‡∏™‡∏≠‡∏á‡∏ä‡∏ô‡∏¥‡∏î: ‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ï‡∏Å ","‡∏™‡∏≤‡∏°‡∏ä‡∏ô‡∏¥‡∏î","‡∏™‡∏µ‡πà‡∏ä‡∏ô‡∏¥‡∏î"], a:1 },
  { q:"‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ ‚ÄúStroke‚Äù ‡∏´‡∏°‡∏≤‡∏¢‡∏ñ‡∏∂‡∏á‡∏≠‡∏∞‡πÑ‡∏£?",
    opts:["‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏ö‡∏≤‡∏î‡πÄ‡∏à‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏Å‡∏•‡πâ‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠","‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô‡∏à‡∏≤‡∏Å‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ï‡∏Å","‡πÅ‡∏Ñ‡πà‡∏õ‡∏ß‡∏î‡∏®‡∏µ‡∏£‡∏©‡∏∞","‡∏Å‡∏£‡∏∞‡∏î‡∏π‡∏Å‡∏´‡∏±‡∏Å"], a:1 },
  { q:"‡∏õ‡∏µ2567 ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡πÄ‡∏™‡∏µ‡∏¢‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì‡∏Å‡∏µ‡πà‡∏Ñ‡∏ô",
    opts:["20 ‡∏Ñ‡∏ô","39000 ‡∏Ñ‡∏ô","100‡∏Ñ‡∏ô","1‡∏Ñ‡∏ô"], a:1 },
  { q:"stroke ‡∏°‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏≠",
    opts:["‡∏Å‡∏¥‡∏ô‡∏ú‡∏±‡∏Å","‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà","‡∏Å‡∏¥‡∏ô‡∏ô‡πâ‡∏≥","‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢"], a:1 },
  { q:"stroke ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏î‡πâ‡∏ß‡∏¢‡∏≠‡∏∞‡πÑ‡∏£",
    opts:["‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏°‡∏î‡∏∂‡∏Å‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô‡∏à‡∏ô‡∏ñ‡∏∂‡∏á‡∏ï‡∏µ‡∏™‡∏≤‡∏°","‡∏ô‡∏≠‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏≠‡∏¥‡πà‡∏°‡∏ó‡∏∏‡∏Å‡πÜ‡∏ß‡∏±‡∏ô","‡∏ô‡∏≠‡∏ô‡∏î‡∏∂‡∏Å","‡∏Å‡∏¥‡∏ô‡∏°‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏´‡∏ß‡∏≤‡∏ô"], a:1 },
  { q:"‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏ñ‡∏∑‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏ß‡∏∞‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
    opts:["‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà","‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏ß‡∏î‡∏°‡∏≤‡∏Å","‡πÉ‡∏ä‡πà ‡∏ó‡∏∏‡∏Å‡∏ô‡∏≤‡∏ó‡∏µ‡∏°‡∏µ‡∏Ñ‡πà‡∏≤","‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ú‡∏π‡πâ‡∏™‡∏π‡∏á‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"], a:2 },
  { q:"‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÇ‡∏£‡∏Ñ stroke‡∏°‡∏µ‡∏≠‡∏∞‡πÑ‡∏£‡∏ö‡πâ‡∏≤‡∏á",
    opts:["BEFAST","Storke","EXPRESS","GeoGebra"], a:0 },
  { q:"‡∏´‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏î‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡πÄ‡∏ï‡∏∑‡∏≠‡∏ôstroke ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏†‡∏≤‡∏¢‡πÉ‡∏ô‡∏Å‡∏µ‡πà‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á",
    opts:["10000000‡∏ô‡∏≤‡∏ó‡∏µ","4 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á","1‚Äì2 ‡∏ß‡∏±‡∏ô","999 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á"], a:1 },
  { q:"‡∏Ñ‡∏ô‡∏ß‡∏±‡∏¢‡∏£‡∏∏‡πà‡∏ô‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÑ‡∏î‡πâ‡πÑ‡∏´‡∏°?",
    opts:["‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ó‡∏≤‡∏á","‡πÑ‡∏î‡πâ ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á","‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤","‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà"], a:1 },
  { q:"‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡πÑ‡∏ó‡∏¢‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
    opts:["‡∏•‡∏î‡∏•‡∏á","‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏™‡∏π‡∏á‡∏ß‡∏±‡∏¢‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á","‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß","‡πÑ‡∏°‡πà‡∏ó‡∏£‡∏≤‡∏ö"], a:1 },
];

const Q2_CAUSES = [
  { q:"‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏Ç‡∏≠‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å‡∏Ñ‡∏∑‡∏≠?",
    opts:["‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ï‡πà‡∏≥","‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á","‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏ï‡πà‡∏≥","‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡∏´‡∏ô‡∏≤‡∏ß"], a:1 },
  { q:"‡∏†‡∏≤‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å?",
    opts:["‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡∏ú‡∏¥‡∏î‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏ä‡∏ô‡∏¥‡∏î Atrial Fibrillation","‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏ô‡∏±‡∏Å‡∏Å‡∏µ‡∏¨‡∏≤","‡∏•‡∏¥‡πâ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏õ‡∏Å‡∏ï‡∏¥","‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÄ‡∏ï‡πâ‡∏ô‡∏ä‡πâ‡∏≤ (Bradycardia)"], a:0 },
  { q:"‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏™‡∏π‡∏á‡∏à‡∏∂‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á?",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á","‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏ú‡∏ô‡∏±‡∏á‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏™","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏¢‡πá‡∏ô"], a:1 },
  { q:"‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
    opts:["‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö","‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÑ‡∏î‡πâ"], a:2 },
  { q:"‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå‡∏Å‡∏±‡∏ö‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡πÄ‡∏û‡∏£‡∏≤‡∏∞‚Ä¶",
    opts:["‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏•‡πá‡∏Å‡πÅ‡∏•‡∏∞‡πÄ‡∏£‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏µ‡∏ö‡πÅ‡∏Ñ‡∏ö","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏•‡∏î‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•"], a:1 },
  { q:"‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•‡∏™‡∏π‡∏á‚Ä¶",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ñ‡∏£‡∏≤‡∏ö‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏™","‡πÑ‡∏°‡πà‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢‡πÄ‡∏™‡∏°‡∏≠‡πÑ‡∏õ","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô"], a:0 },
  { q:"Atrial fibrillation ‡∏≠‡∏≤‡∏à‚Ä¶",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡πÉ‡∏à‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏•‡∏∏‡∏î‡πÑ‡∏õ‡∏≠‡∏∏‡∏î‡∏™‡∏°‡∏≠‡∏á","‡∏´‡∏¢‡∏∏‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï","‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô"], a:0 },
  { q:"‡∏î‡∏∑‡πà‡∏°‡πÅ‡∏≠‡∏•‡∏Å‡∏≠‡∏Æ‡∏≠‡∏•‡πå‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡∏≠‡∏≤‡∏à‚Ä¶",
    opts:["‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏ö‡∏Å‡∏ß‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏∞‡∏´‡∏±‡∏ß‡πÉ‡∏à","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å","‡πÅ‡∏Ñ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏ß‡∏á"], a:1 },
  { q:"‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡πÄ‡∏£‡∏∑‡πâ‡∏≠‡∏£‡∏±‡∏á‚Ä¶",
    opts:["‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏™‡∏π‡∏á‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏¢‡πà‡∏•‡∏á","‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏±‡∏á‡∏ß‡∏•","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î"], a:1 },
  { q:"‡∏Ç‡πâ‡∏≠‡πÉ‡∏î‡∏Ñ‡∏∑‡∏≠‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÑ‡∏î‡πâ?",
    opts:["‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏ô‡∏ò‡∏∏‡∏Å‡∏£‡∏£‡∏°","‡∏≠‡∏≤‡∏´‡∏≤‡∏£ ‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢ ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡∏Å‡∏≤‡∏£‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà","‡πÅ‡∏Ñ‡πà‡πÄ‡∏û‡∏®","‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á"], a:1 },
];

const Q3_PREVENT = [
  { q:"‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÅ‡∏ö‡∏ö‡πÑ‡∏´‡∏ô‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å?",
    opts:["‡∏Ç‡∏≠‡∏á‡∏ó‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡πá‡∏°‡∏à‡∏±‡∏î","‡∏ú‡∏±‡∏Å‡∏ú‡∏•‡πÑ‡∏°‡πâ ‡∏ò‡∏±‡∏ç‡∏û‡∏∑‡∏ä‡πÑ‡∏°‡πà‡∏Ç‡∏±‡∏î‡∏™‡∏µ ‡∏õ‡∏•‡∏≤ ‡∏•‡∏î‡∏´‡∏ß‡∏≤‡∏ô/‡πÄ‡∏Ñ‡πá‡∏°","‡∏Å‡∏¥‡∏ô‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏∑‡πâ‡∏≠","‡∏û‡∏∂‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"], a:1 },
  { q:"‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏Ñ‡∏∑‡∏≠?",
    opts:["‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 150 ‡∏ô‡∏≤‡∏ó‡∏µ/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á) + ‡πÄ‡∏ß‡∏ó 2 ‡∏ß‡∏±‡∏ô","‡∏£‡∏ß‡∏° 30 ‡∏ô‡∏≤‡∏ó‡∏µ","‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á ‡∏´‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡πÄ‡∏î‡πá‡∏Å","‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡πÄ‡∏™‡∏≤‡∏£‡πå‚Äì‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå"], a:0 },
  { q:"‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏û‡∏£‡∏≤‡∏∞‚Ä¶",
    opts:["‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ï‡∏±‡∏ß‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô","‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏£‡∏∏‡πä‡∏õ‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏¢‡∏ï‡∏≤‡∏•‡∏î‡∏•‡∏á"], a:0 },
  { q:"‡πÄ‡∏•‡∏¥‡∏Å‡∏™‡∏π‡∏ö‡∏ö‡∏∏‡∏´‡∏£‡∏µ‡πà‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÑ‡∏£?",
    opts:["‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô","‡∏•‡∏î‡∏•‡∏á‡∏°‡∏≤‡∏Å‡πÉ‡∏ô 1‚Äì2 ‡∏õ‡∏µ ‡πÅ‡∏•‡∏∞‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Ñ‡∏ô‡πÑ‡∏°‡πà‡∏™‡∏π‡∏ö‡πÉ‡∏ô ~5 ‡∏õ‡∏µ","‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°","‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏Ñ‡πà‡∏õ‡∏≠‡∏î"], a:1 },
  { q:"‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏î‡∏¢‚Ä¶",
    opts:["‡πÑ‡∏î‡πâ‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏ü‡∏£‡∏µ","‡∏Ñ‡∏±‡∏î‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏±‡∏¢‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡πÄ‡∏ô‡∏¥‡πà‡∏ô ‡πÜ","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏á‡πà‡∏ß‡∏á","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô"], a:1 },
  { q:"‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô/‡∏≠‡πâ‡∏ß‡∏ô‚Ä¶",
    opts:["‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á","‡πÑ‡∏°‡πà‡∏Å‡∏£‡∏∞‡∏ó‡∏ö","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏ú‡πà‡∏≤‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡πÄ‡∏ö‡∏≤‡∏´‡∏ß‡∏≤‡∏ô ‡πÑ‡∏Ç‡∏°‡∏±‡∏ô‡∏™‡∏π‡∏á","‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô"], a:2 },
  { q:"‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡πÉ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‚Ä¶",
    opts:["‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏´‡∏•‡∏≠‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å","‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏ï‡∏≤"], a:1 },
  { q:"‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‚Ä¶",
    opts:["‡∏≠‡∏≤‡∏à‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô","‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏™‡∏°‡∏≠","‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î","‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î"], a:0 },
  { q:"‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏Ñ‡∏£‡∏µ‡∏¢‡∏î‡∏ä‡πà‡∏ß‡∏¢‡πÇ‡∏î‡∏¢‚Ä¶",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥‡πÅ‡∏•‡∏∞‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Ç‡∏∂‡πâ‡∏ô","‡∏ó‡∏≥‡∏•‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏≠‡∏ô","‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡πÄ‡∏•‡∏™‡πÄ‡∏ï‡∏≠‡∏£‡∏≠‡∏•","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î"], a:0 },
  { q:"‡∏Å‡∏≤‡∏£‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠‚Ä¶",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÅ‡∏¢‡πà‡∏•‡∏á","‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÑ‡∏´‡∏•‡πÄ‡∏ß‡∏µ‡∏¢‡∏ô‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°","‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏™‡πÇ‡∏ï‡∏£‡∏Å","‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÑ‡∏î‡πâ"], a:1 },
];

const Q4_BEFAST = [
  { q:"BEFAST ‡∏¢‡πà‡∏≠‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏≠‡∏∞‡πÑ‡∏£?",
    opts:[
      "Brain, Eye, Feet, Arms, Speech, Talk",
      "Balance, Eyes, Face, Arms, Speech, Time",
      "Breathe, Eat, Fast, Act, Sit, Talk",
      "Blink, Ear, Face, Abdomen, Sleep, Time"
    ], a:1 },
  { q:"B = ?", opts:["Breath","‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß (Balance)","Bones","Belief"], a:1 },
  { q:"E = ?", opts:["‡∏õ‡∏ß‡∏î‡∏´‡∏π","‡∏ï‡∏≤: ‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥/‡∏ï‡∏≤‡∏°‡∏±‡∏ß‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô","‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡πà‡∏≥","‡∏®‡∏≠‡∏Å‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á"], a:1 },
  { q:"F = ?", opts:["‡πÑ‡∏Ç‡πâ","‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß","‡∏õ‡∏ß‡∏î‡πÄ‡∏ó‡πâ‡∏≤","‡πÅ‡∏û‡πâ‡∏≠‡∏≤‡∏´‡∏≤‡∏£"], a:1 },
  { q:"A = ?", opts:["‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á","‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤‡πÄ‡∏Ñ‡∏•‡πá‡∏î","‡∏´‡∏∑‡∏î","‡πÇ‡∏•‡∏´‡∏¥‡∏ï‡∏à‡∏≤‡∏á"], a:0 },
  { q:"S = ?", opts:["‡∏á‡πà‡∏ß‡∏á‡∏ô‡∏≠‡∏ô","‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î/‡∏™‡∏∑‡πà‡∏≠‡∏™‡∏≤‡∏£‡∏•‡∏≥‡∏ö‡∏≤‡∏Å","‡πÄ‡∏´‡∏á‡∏∑‡πà‡∏≠‡∏≠‡∏≠‡∏Å","‡∏ú‡∏¥‡∏ß‡πÑ‡∏´‡∏°‡πâ‡πÅ‡∏î‡∏î"], a:1 },
  { q:"T = ?", opts:["‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ","‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÇ‡∏ó‡∏£‡∏â‡∏∏‡∏Å‡πÄ‡∏â‡∏¥‡∏ô","‡∏û‡∏±‡∏Å‡∏î‡∏∑‡πà‡∏°‡∏ä‡∏≤","‡∏á‡∏µ‡∏ö"], a:1 },
  { q:"‡∏´‡∏≤‡∏Å‡∏û‡∏ö‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì BEFAST ‡∏Ñ‡∏ß‡∏£‚Ä¶",
    opts:["‡∏£‡∏≠‡∏î‡∏π‡∏ó‡∏µ‡πà‡∏ö‡πâ‡∏≤‡∏ô","‡πÇ‡∏ó‡∏£ 1669 ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ","‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥","‡∏´‡∏≤‡∏î‡∏π‡πÉ‡∏ô YouTube"], a:1 },
  { q:"‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏¥‡πà‡∏á‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç?",
    opts:["‡∏™‡∏°‡∏≠‡∏á‡∏ó‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ","‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏£‡πá‡∏ß ‡∏™‡∏°‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏´‡∏≤‡∏¢‡∏ô‡πâ‡∏≠‡∏¢‡∏•‡∏á","‡∏£‡∏ñ‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏ä‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß","‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç"], a:1 },
  { q:"‡∏ó‡∏≥‡πÑ‡∏°‡πÑ‡∏°‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏≠‡πÉ‡∏´‡πâ‡∏≠‡∏≤‡∏Å‡∏≤‡∏£‡∏´‡∏≤‡∏¢‡πÄ‡∏≠‡∏á?",
    opts:["‡∏£‡∏≠‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Å‡∏ß‡πà‡∏≤","‡∏¢‡∏¥‡πà‡∏á‡∏ä‡πâ‡∏≤ ‡∏¢‡∏¥‡πà‡∏á‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏ñ‡∏≤‡∏ß‡∏£","‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏õ‡∏¥‡∏î","‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏Å‡πá‡∏´‡∏≤‡∏¢"], a:1 },
];

const Q5_TREAT = [
  { q:"‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏™‡∏±‡∏¢‡∏ß‡πà‡∏≤‡πÉ‡∏Ñ‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏£‡∏Å‡∏Ñ‡∏∑‡∏≠?",
    opts:["‡πÉ‡∏´‡πâ‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡πÇ‡∏ó‡∏£‡∏Ç‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡∏ö‡∏ô‡∏≥‡∏™‡πà‡∏á‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•","‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡∏ô‡∏≠‡∏ô‡∏û‡∏±‡∏Å","‡∏ô‡∏ß‡∏î"], a:1 },
  { q:"‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡πÉ‡∏´‡πâ‡πÄ‡∏£‡πá‡∏ß?",
    opts:["‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÑ‡∏î‡πâ‡∏ú‡∏•‡πÅ‡∏•‡∏∞‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‡∏î‡∏µ","‡πÑ‡∏õ‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô","‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£","‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•"], a:0 },
  { q:"‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡πÉ‡∏î‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏¢‡∏Å‡∏ä‡∏ô‡∏¥‡∏î‡∏™‡πÇ‡∏ï‡∏£‡∏Å?",
    opts:["‡∏≠‡∏±‡∏•‡∏ï‡∏£‡∏≤‡∏ã‡∏≤‡∏ß‡∏î‡πå","CT/MRI","‡πÄ‡∏≠‡∏Å‡∏ã‡πÄ‡∏£‡∏¢‡πå‡∏Ç‡∏≤","‡∏ß‡∏±‡∏î‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥"], a:1 },
  { q:"‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏≠‡∏≤‡∏à‚Ä¶",
    opts:["‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏•‡∏¥‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏î","‡πÉ‡∏´‡πâ‡∏¢‡∏≤‡∏ô‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏ö","‡πÑ‡∏°‡πà‡∏ó‡∏≥‡∏≠‡∏∞‡πÑ‡∏£","‡∏õ‡∏£‡∏∞‡∏Ñ‡∏ö‡πÄ‡∏¢‡πá‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß"], a:0 },
  { q:"‡∏ñ‡πâ‡∏≤‡πÄ‡∏™‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏ï‡∏Å ‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏à‡∏∞‚Ä¶",
    opts:["‡∏õ‡∏•‡πà‡∏≠‡∏¢‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å","‡∏´‡∏¢‡∏∏‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏î (‡∏ö‡∏≤‡∏á‡∏Å‡∏£‡∏ì‡∏µ‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î)","‡πÉ‡∏´‡πâ‡∏Ç‡∏ô‡∏°","‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô"], a:1 },
  { q:"‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏≥‡∏ö‡∏±‡∏î‡∏´‡∏•‡∏±‡∏á‡∏™‡πÇ‡∏ï‡∏£‡∏Å?",
    opts:["‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ü‡∏∑‡πâ‡∏ô‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß","‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ù‡∏∂‡∏Å‡∏ó‡∏≥‡∏≠‡∏≤‡∏´‡∏≤‡∏£","‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•","‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô"], a:0 },
  { q:"‡πÉ‡∏Ñ‡∏£‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î?",
    opts:["‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå","‡∏ô‡∏±‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î","‡πÄ‡∏ä‡∏ü","‡∏ô‡∏±‡∏Å‡∏ö‡∏¥‡∏ô"], a:1 },
  { q:"‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ä‡πà‡∏ß‡∏á‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß‚Ä¶",
    opts:["‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏´‡∏≤‡∏¢‡∏ä‡πâ‡∏≤","‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏£‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏ä‡πà‡∏ß‡∏¢‡∏ã‡πà‡∏≠‡∏°‡πÅ‡∏ã‡∏°‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢","‡∏≠‡∏∏‡∏î‡∏ï‡∏±‡∏ô‡∏ó‡πà‡∏≠‡∏ô‡πâ‡∏≥‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á","‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå"], a:1 },
  { q:"‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÉ‡∏à‡∏à‡∏≤‡∏Å‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏±‡∏ß‚Ä¶",
    opts:["‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç","‡∏ä‡πà‡∏ß‡∏¢‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏£‡∏á‡∏à‡∏π‡∏á‡πÉ‡∏à‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ü‡∏∑‡πâ‡∏ô‡∏ï‡∏±‡∏ß","‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏ó‡∏©‡∏ï‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤","‡∏ó‡∏î‡πÅ‡∏ó‡∏ô‡∏¢‡∏≤‡πÑ‡∏î‡πâ"], a:1 },
  { q:"‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏™‡πÇ‡∏ï‡∏£‡∏Å‡∏ã‡πâ‡∏≥ ‡∏Ñ‡∏ß‡∏£‚Ä¶",
    opts:["‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô‡πÇ‡∏•‡∏´‡∏¥‡∏ï","‡∏Å‡∏¥‡∏ô‡∏î‡∏µ ‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á ‡∏Ñ‡∏∏‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏ô ‡∏û‡∏ö‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ï‡∏≤‡∏°‡∏ô‡∏±‡∏î","‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏•‡∏≠‡∏î‡πÑ‡∏õ","‡∏á‡∏î‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥"], a:1 },
];

// --- attach stable IDs to each question for stats ---
function tagBank(tag, bank){ bank.forEach((q,i)=>{ if(!q.id) q.id = `${tag}-${String(i+1).padStart(2,'0')}`; }); }
tagBank("B1", Q1_BASIC);
tagBank("B2", Q2_CAUSES);
tagBank("B3", Q3_PREVENT);
tagBank("B4", Q4_BEFAST);
tagBank("B5", Q5_TREAT);

// Category map: 1‚Äì3 ‚Üí Q1, 4‚Äì6 ‚Üí Q2, 7‚Äì9 ‚Üí Q3, 10‚Äì12 ‚Üí Q4, 13‚Äì15 ‚Üí Q5
function categoryForLevel(levelIdx){ return Math.floor(levelIdx / 3) + 1; } // 1..5
function bankForCategory(cat){ return [null, Q1_BASIC, Q2_CAUSES, Q3_PREVENT, Q4_BEFAST, Q5_TREAT][cat] || Q1_BASIC; }

// ====== helpers ======
function shuffle(arr){
  const a = arr.slice();
  for (let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}
function pickQuestionsForCheckpoint(levelIdx){
  const cat = categoryForLevel(levelIdx);
  const bank = bankForCategory(cat);
  // deep-copy and keep stable id
  return shuffle(bank).slice(0, 10).map(q => ({ q: q.q, opts: q.opts.slice(), a: q.a, id: q.id }));
}
function renderPoints(n){
  CURRENT_POINTS = n|0;
  const el = document.getElementById("pointsNum");
  if (el) el.textContent = String(CURRENT_POINTS);
}
function nodeElement(index, state){
  const li = document.createElement("li");
  li.className = `node ${state}`;
  li.innerHTML = `
    <div class="badge">${state==="done"?"‚úì":index+1}</div>
    <div class="label">‡∏î‡πà‡∏≤‡∏ô ${index+1}</div>
  `;
  return li;
}

// streak helpers (daily)
const ymd = (d)=> {
  const y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), da=String(d.getDate()).padStart(2,'0');
  return `${y}-${m}-${da}`;
};
function isYesterday(prevYmd, todayYmd){
  if (!prevYmd) return false;
  const [py,pm,pd] = prevYmd.split('-').map(n=>parseInt(n,10));
  const [ty,tm,td] = todayYmd.split('-').map(n=>parseInt(n,10));
  const prev = new Date(py, pm-1, pd);
  const today= new Date(ty, tm-1, td);
  const diffDays = Math.round((today - prev) / (24*60*60*1000));
  return diffDays === 1;
}

// ====== Build the path ======
async function buildPath(user){
  const path = document.getElementById("path");
  const allDoneEl = document.getElementById("allDone");
  if (!path) return;

  const docRef = db.collection("users").doc(user.uid);
  const snap = await docRef.get();

  if (!snap.exists) {
    await docRef.set({
      username:(user.email||"").split("@")[0],
      cards:[],
      mission:Array(LEVEL_COUNT).fill(false),
      points:0,
      // seed new fields
      quizCount: 0,
      quizStreak: 0,
      quizLastYmd: null
    }, {merge:true});
  }

  const data = (await docRef.get()).data() || {};
  let completed = Array.isArray(data.mission) ? data.mission.slice(0, LEVEL_COUNT) : Array(LEVEL_COUNT).fill(false);
  while (completed.length < LEVEL_COUNT) completed.push(false);

  // ensure 15 items stored (fixes older 10-slot users)
  if (!Array.isArray(data.mission) || data.mission.length !== LEVEL_COUNT) {
    await docRef.set({ mission: completed }, { merge: true });
  }

  renderPoints(typeof data.points==="number" ? data.points : 0);

  const activeIdx = completed.findIndex(v=>!v);
  path.innerHTML = "";
  if (activeIdx === -1) {
    allDoneEl?.classList.remove("hidden");
    for (let i=0;i<LEVEL_COUNT;i++) path.appendChild(nodeElement(i,"done"));
    return;
  }
  allDoneEl?.classList.add("hidden");

  for (let i=0;i<LEVEL_COUNT;i++){
    const state = completed[i] ? "done" : (i===activeIdx ? "active" : "locked");
    const li = nodeElement(i, state);
    const btn = li.querySelector(".badge");
    if (state==="active") btn.addEventListener("click", ()=>startQuiz(i, docRef, completed));
    if (state==="locked") btn.addEventListener("click", ()=>toast("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô"));
    path.appendChild(li);
  }
}

// ====== Quiz flow ======
function startQuiz(levelIdx, docRef, completed){
  const modal = document.getElementById("quizModal");
  const box   = document.getElementById("quizBox");

  const questions = pickQuestionsForCheckpoint(levelIdx);
  let idx = 0;
  const answers = Array(10).fill(undefined);

  function render(){
    const q = questions[idx];
    box.innerHTML = `
      <button class="close-x" id="closeX" aria-label="Close">√ó</button>
      <div class="q-header">
        <div class="q-title" id="quizTitle">‡∏î‡πà‡∏≤‡∏ô ${levelIdx+1}</div>
        <div class="q-progress">${idx+1}/10</div>
      </div>
      <div class="q-body">${q.q}</div>
      <div class="q-options">
        ${q.opts.map((t,i)=>`<div class="q-option" data-i="${i}">${t}</div>`).join("")}
      </div>
      <div class="q-actions">
        ${idx>0?'<button class="btn btn-grey" id="backBtn">‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>':''}
        <button class="btn btn-red" id="nextBtn">${idx<9?'‡∏ñ‡∏±‡∏î‡πÑ‡∏õ':'‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô'}</button>
      </div>
    `;
    modal.classList.add("show");

    document.getElementById("closeX").onclick = ()=> modal.classList.remove("show");

    // restore selection
    let selected = (answers[idx] !== undefined) ? answers[idx] : -1;
    const opts = [...box.querySelectorAll(".q-option")];
    const highlight =()=>opts.forEach(o=>o.classList.toggle("selected", Number(o.dataset.i)===selected));
    highlight();
    opts.forEach(el=>el.onclick=()=>{ selected=Number(el.dataset.i); answers[idx]=selected; highlight(); });

    if (idx>0) document.getElementById("backBtn").onclick=()=>{ idx--; render(); };

    document.getElementById("nextBtn").onclick = async ()=>{
      if (selected === -1) return;
      if (idx < 9) { idx++; render(); return; }

      // Finished ‚Äî compute score
      const correct = answers.reduce((sum,ans,i)=> sum + (ans===questions[i].a ? 1 : 0), 0);
      const firstTime = !completed[levelIdx];

      // --- write per-question attempt stats (parallel, faster) ---
      try{
        const writes = questions.map((q, i) =>
          db.collection('questionStats').doc(q.id)
            .collection('answers')
            .add({
              uid: CURRENT_USER.uid,
              correct: (answers[i] === q.a),
              level: levelIdx+1,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            })
        );
        await Promise.all(writes);
      }catch(e){ log("questionStats write failed:", e); }

      if (correct === 10){
        completed[levelIdx] = true;

        // points: only once per level (keep old logic)
        if (firstTime){
          await docRef.set({ mission: completed, points: firebase.firestore.FieldValue.increment(1) }, {merge:true});
          renderPoints(CURRENT_POINTS + 1);
        } else {
          await docRef.set({ mission: completed }, {merge:true});
        }

        // quizCount + daily streak (count successful 10/10 only)
        try{
          const uSnap = await docRef.get();
          const uData = uSnap.data() || {};
          const today = ymd(new Date());
          let streak = (uData.quizStreak|0) || 0;
          const last  = uData.quizLastYmd || null;

          if (last === today) {
            // already counted today -> keep streak
          } else if (isYesterday(last, today)) {
            streak = (streak|0) + 1;
          } else {
            streak = 1;
          }

          await docRef.set({
            quizCount: firebase.firestore.FieldValue.increment(1),
            quizStreak: streak,
            quizLastYmd: today
          }, { merge: true });
        }catch(e){ log("streak update error:", e); }

        box.innerHTML = `
          <button class="close-x" id="closeX2" aria-label="Close">√ó</button>
          <div class="center">
            <h2 class="q-title">üéâ ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏°‡∏≤‡∏Å! ‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å 10/10</h2>
            <p>‡∏Ñ‡∏∏‡∏ì‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô‡∏ó‡∏µ‡πà ${levelIdx+1} ‡πÅ‡∏•‡πâ‡∏ß</p>
            <p>+1 üß† ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${firstTime?'(‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å)':'(‡πÄ‡∏Ñ‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß)'}</p>
            <button class="btn btn-red" id="okBtn">‡∏ï‡∏Å‡∏•‡∏á</button>
          </div>`;
        document.getElementById("closeX2").onclick=()=>modal.classList.remove("show");
        document.getElementById("okBtn").onclick = ()=>location.reload();
      } else {
        box.innerHTML = `
          <button class="close-x" id="closeX3" aria-label="Close">√ó</button>
          <div class="center">
            <h2 class="q-title">‡∏™‡∏π‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏õ!</h2>
            <p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ <b>${correct}/10</b> ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ <b>10/10</b> ‡∏ñ‡∏∂‡∏á‡∏à‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏î‡πà‡∏≤‡∏ô</p>
            <div class="q-actions" style="justify-content:center">
              <button class="btn btn-grey" id="closeBtn">‡∏õ‡∏¥‡∏î</button>
              <button class="btn btn-red" id="retryBtn">‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
            </div>
          </div>`;
        document.getElementById("closeX3").onclick=()=>modal.classList.remove("show");
        document.getElementById("closeBtn").onclick = ()=>modal.classList.remove("show");
        document.getElementById("retryBtn").onclick = ()=>{
          const fresh = pickQuestionsForCheckpoint(levelIdx);
          for (let i=0;i<10;i++) questions[i] = fresh[i];
          idx = 0; answers.fill(undefined); render();
        };
      }
    };
  }
  render();
}

// ====== Simple notice modal ======
function toast(msg){
  const modal = document.getElementById("quizModal");
  const box   = document.getElementById("quizBox");
  box.innerHTML = `
    <button class="close-x" id="closeNoticeX" aria-label="Close">√ó</button>
    <div class="center">
      <h3 class="q-title">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô</h3>
      <p>${msg}</p>
      <button class="btn btn-red" id="closeNotice">‡∏ï‡∏Å‡∏•‡∏á</button>
    </div>`;
  modal.classList.add("show");
  document.getElementById("closeNoticeX").onclick = ()=>modal.classList.remove("show");
  document.getElementById("closeNotice").onclick  = ()=>modal.classList.remove("show");
   }
